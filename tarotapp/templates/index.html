{% load static %}
<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ú–æ–ª—å—Ñ–∞—Ä–∫–∞ ‚Äî –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è –∑ –®–Ü. –ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –æ–Ω–ª–∞–π–Ω</title>
    <meta name="description" content="–®–≤–∏–¥–∫—ñ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –¢–∞—Ä–æ –≤—ñ–¥ –ú–æ–ª—å—Ñ–∞—Ä–∫–∏. –û–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É, –ø–æ—Å—Ç–∞–≤—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –æ—Ç—Ä–∏–º–∞–π—Ç–µ –º—ñ—Å—Ç–∏—á–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å." />

    <link rel="icon" href="{% static 'images/molfarka.png' %}" type="image/png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}" />
    <link rel="stylesheet" href="{% static 'css/jquery.mCustomScrollbar.min.css' %}" />
    <!-- –õ–µ–≥–∫–∏–µ –∏–∫–æ–Ω–∫–∏ (Font Awesome 4 —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω —É –≤–∞—Å; –¥–æ–±–∞–≤–∏–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-V6u0..." crossorigin="anonymous" referrerpolicy="no-referrer"/>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Sen:wght@700;800&display=swap" rel="stylesheet"/>
   <!-- Bootstrap 5 JS -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XEMLCQ65YQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag("js", new Date());
      gtag("config", "G-XEMLCQ65YQ");
    </script>
  </head>

  <body class="cosmic-bg">



    <!-- Header -->
    <header class="navbar navbar-expand-lg navbar-dark cosmic-nav">
      <div class="container">
    
        <!-- –õ–æ–≥–æ -->
        <a class="navbar-brand d-flex align-items-center" href="/">
          <img src="{% static 'images/molfarka-logo.png' %}" alt="MOLFARKA" class="brand-logo me-2">
          <span class="visually-hidden">MOLFARKA</span>
        </a>
    
        <!-- –ö–Ω–æ–ø–∫–∞-–±—É—Ä–≥–µ—Ä –¥–ª—è –º–æ–±–∏–ª—ã -->
        <button class="navbar-toggler d-md-none" type="button"
        data-bs-toggle="offcanvas" data-bs-target="#molfarkaMenu"
        aria-controls="molfarkaMenu" aria-label="–ú–µ–Ω—é">
  <span class="navbar-toggler-icon">
    <div></div>
    <div></div>
    <div></div>
  </span>
</button>
    
        <!-- –ú–µ–Ω—é (–¥–µ—Å–∫—Ç–æ–ø) -->
        <div class="collapse navbar-collapse d-none d-md-flex justify-content-end">
          <ul class="navbar-nav gap-4">
            <li class="nav-item">
              <a class="nav-link text-light d-flex align-items-center" href="#predict">
                <i class="fa-solid fa-wand-sparkles me-2"></i> –í–æ—Ä–æ–∂—ñ–Ω–Ω—è
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link text-light d-flex align-items-center" style="white-space: nowrap;" href="#how">
                <i class="fa-regular fa-star me-2"></i> –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î
              </a>
            </li>
          </ul>
        </div>
      </div>
    </header>
    
    <!-- Offcanvas (–º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é) -->
    <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="molfarkaMenu">
      <div class="offcanvas-header">
        <img src="{% static 'images/molfarka-logo.png' %}" class="brand-logo me-2" alt="MOLFARKA">
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
      </div>
      <div class="offcanvas-body">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link text-light d-flex align-items-center" href="#predict" data-bs-dismiss="offcanvas">
              <i class="fa-solid fa-wand-sparkles me-2"></i> –í–æ—Ä–æ–∂—ñ–Ω–Ω—è
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-light d-flex align-items-center" href="#how" data-bs-dismiss="offcanvas" style="white-space: nowrap;">
              <i class="fa-regular fa-star me-2 "></i> –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Hero -->
    <section class="hero container py-5">
      <div class="row align-items-center g-4">
        <div class="col-lg-6">
          <h1 class="display-6 fw-bold text-gradient mb-3">–í–æ—Ä–æ–∂—ñ–Ω–Ω—è –æ–Ω–ª–∞–π–Ω –∑ –®–Ü</h1>
          <p class="lead text-light-80 mb-4">
            –ú–æ–ª—å—Ñ–∞ÃÅ—Ä ‚Äî —É –≥—É—Ü—É–ª—å—Å—å–∫—ñ–π –∫—É–ª—å—Ç—É—Ä—ñ –Ω–æ—Å—ñ–π –Ω–∞–¥–ø—Ä–∏—Ä–æ–¥–Ω–∏—Ö –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π, —â–æ –ø–æ—î–¥–Ω—É—î —Ä–∏—Å–∏ –∑–Ω–∞—Ö–∞—Ä—è —Ç–∞ –≤–æ—Ä–æ–∂–±–∏—Ç–∞.
            –û–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É, –ø–æ—Å—Ç–∞–≤—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî —ñ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –º—ñ—Å—Ç–∏—á–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å.
          </p>
          <a href="#readings" class="btn btn-neon btn-lg mb-3">
            <i class="fa-solid fa-crystal-ball me-2"></i> –ü–æ—á–∞—Ç–∏ –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è
          </a>
        </div>
        <div class="col-lg-6 text-center">
          <div class="hero-illustration glass p-3">
            <img src="{% static 'images/ai-tarot4.png' %}" alt="AI Tarot" class="img-fluid floating"/>
          </div>
        </div>
      </div>
    </section>

    <!-- Reading Form -->
    <section id="readings" class="container pb-5">
      <div class="row g-4">
        <div class="col-lg-7 order-1 order-lg-1 mb-3">
          <div class="glass p-4 h-100">
            <h2 class="h3 mb-3 text-gradient"><i class="fa-solid fa-hat-wizard me-2"></i>–ö–ª–∞—Å–∏—á–Ω–µ –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è –¢–∞—Ä–æ</h2>
            <p class="mb-4 text-light-80">–û–ë–ï–†–ò, –ó–ê–ü–ò–¢–ê–ô, –û–¢–†–ò–ú–ê–ô –í–Ü–î–ü–û–í–Ü–î–¨</p>
            <div class="readings-banner text-center">
              <img src="{% static 'images/tarot-cards3.png' %}" alt="Tarot" class="img-fluid"/>
            </div>
          </div>
        </div>

        <div class="col-lg-5 order-2 order-lg-2 mb-3">
          <div class="glass p-4 h-100">
            <p class="small text-light-70 mb-3">
              –ù–∞–π—Ç–æ—á–Ω—ñ—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤–∏—Ö–æ–¥—è—Ç—å, –∫–æ–ª–∏ –≤–∏ –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–µ—Ç–µ —Å–≤–æ—é —Å–∏—Ç—É–∞—Ü—ñ—é –∞–±–æ –ø–æ–±–∞–∂–∞–Ω–Ω—è.
            </p>

            <div class="mb-3">
              <label for="question" class="form-label text-gradient">
                <span class="icon-pill me-2"><i class="fa-regular fa-comment-dots"></i></span>
                –í–∞—à–µ –ø–∏—Ç–∞–Ω–Ω—è (–±—É–¥—å-—è–∫–∞ –º–æ–≤–∞)
              </label>
              <textarea id="question" name="question" class="form-control form-control-glass" rows="4" maxlength="500" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –©–æ –º–µ–Ω–µ —á–µ–∫–∞—î —É –∫–æ—Ö–∞–Ω–Ω—ñ?"></textarea>
            </div>

            <div class="row g-3 align-items-end">
              <div class="col-7">
                <label for="deck" class="form-label text-gradient">
                  <span class="icon-pill me-2"><i class="fa-solid fa-layer-group"></i></span>
                  –û–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É
                </label>
                <select id="deck" name="deck" class="form-select form-control-glass">
                  {% for deck in decks %}
                    <option value="{{ deck.slug }}" data-max="{{ deck.max_cards }}">{{ deck.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-5">
                <label for="count" class="form-label text-gradient">
                  <span class="icon-pill me-2"><i class="fa-solid fa-hashtag"></i></span>
                  –ö—ñ–ª-—Ç—å –∫–∞—Ä—Ç
                </label>
                <input type="number" id="count" name="count" class="form-control form-control-glass" value="3" min="1" max="10"/>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button id="ask" class="btn btn-neon btn-lg">
                <i class="fa-solid fa-sparkles me-2"></i> –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="response" class="glass p-4 mt-4 d-none text-light-80" style="white-space: pre-wrap;"></div>
    </section>

   <!-- Video Form -->
   <section id="videos" class="container pb-5">
      <div class="row g-4">
        <div class="col-lg-5 order-1 order-lg-1 mb-3">
         
          <div class="glass p-4 h-100">
            <h2 class="h3 mb-3 text-gradient"><i class="fa-solid fa-hat-wizard me-2"></i>–í–æ—Ä–æ–∂—ñ–Ω–Ω—è –∑ –≤—ñ–¥–µ–æ</h2>
            
            <p class="small text-light-70 mb-3">
              –ù–∞–π—Ç–æ—á–Ω—ñ—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤–∏—Ö–æ–¥—è—Ç—å, –∫–æ–ª–∏ –≤–∏ –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–µ—Ç–µ —Å–≤–æ—é —Å–∏—Ç—É–∞—Ü—ñ—é –∞–±–æ –ø–æ–±–∞–∂–∞–Ω–Ω—è.
            </p>

            <div class="mb-3">
              <label for="question-video" class="form-label text-gradient">
                <span class="icon-pill me-2"><i class="fa-regular fa-comment-dots"></i></span>
                –û–±–µ—Ä—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è:
              </label>
              <select id="base_question" name="base_question" class="form-select form-control-glass">
                  {% for q in base_questions %}
                    <option value="{{ base_question.id }}">{{ q.text }}</option>
                  {% endfor %}
                </select>
            </div>

            

            <div class="d-grid mt-4">
              <button id="video" class="btn btn-neon btn-lg">
                <i class="fa-solid fa-sparkles me-2"></i> –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è
              </button>
            </div>
          </div>
        </div>

            <div class="col-lg-7 order-2 order-lg-2 mb-3">
            <div class="glass p-4 h-100">
               <p class="mb-4 text-gradient h5"><i class="fa-solid fa-wand-magic-sparkles me-2"></i>–ú–æ–∂–ª–∏–≤–æ, —Ç—É—Ç –±—ñ–ª—å—à–µ –≤—ñ–¥–ø–æ–≤–∏–¥–µ–π</p>
               <div id="response_video" class="video-banner text-center">
                  <img src="{% static 'images/video-banner.png' %}" alt="Tarot" class="img-fluid"/>
               </div>
            </div>
            </div>

         </div>
    </section>

    <!-- Info -->
    <section id="how" class="container pb-5">
      <div class="glass p-4 text-light-80">
        <h3 class="h4 mb-2 text-gradient">–î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
        <p class="mb-1">–ó—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –≤–∞—Å. –ö–æ—Ä–∏—Å—Ç—É–π—Ç–µ—Å—å –Ω–∞ –∑–¥–æ—Ä–æ–≤'—è!</p>
        <p class="mb-0">–ú–∏ –ø–æ—Å—Ç—É–ø–æ–≤–æ –ø–æ–∫—Ä–∞—â—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Ç–∞ —Ä–æ–∑—à–∏—Ä—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª.</p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-4 text-center text-gradient">
      <div class="container small">¬© 2025 Molfarka</div>
    </footer>

    <!-- JS -->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <!-- <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script> -->
    <!--  <script src="{% static 'js/custom.js' %}"></script> -->
    <script>
      function getCookie(name){
  const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
  return m ? m.pop() : '';
}
$.ajaxSetup({
  beforeSend: function(xhr, settings){
    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
      xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
    }
  }
});
    </script>

    <script>
      $(function () {
        $('#deck').on('change', function () {
          let max = $(this).find(':selected').data('max');
          $('#count').attr('max', max);
          if (parseInt($('#count').val(), 10) > max) $('#count').val(max);
        });



        $('#video').on('click', function () {
    gtag('event', 'click', { event_category: 'prediction', event_label: 'Video button clicked' });

    
    const baseQuestion = $('#base_question option:selected').text().trim();
    
    if (!baseQuestion) {
        return $('#response_video')
            .removeClass('d-none')
            .html('‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è–º.');
    }

    const $btn = $(this).prop('disabled', true);
    $('#response_video')
        .removeClass('d-none')
        .html('‚è≥ –ú–æ–ª—å—Ñ–∞—Ä–∫–∞ –≥–æ—Ç—É—î –≤—ñ–¥–µ–æ...');

    $.post('/video_prediction/', { question: baseQuestion }, function (data) {
        if (data.video_url) {
            $('#response_video').html(
                '<iframe src="' + data.video_url + '" width="100%" height="320" frameborder="0" allowfullscreen></iframe>'
            );
            window.scrollTo({
                top: $('#response_video').offset().top - 80,
                behavior: 'smooth'
            });
        } else {
            $('#response_video').html('üòî –í—ñ–¥–µ–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.');
        }
        $btn.prop('disabled', false);
    }, 'json').fail(function () {
        $('#response_video').html('üòî –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≤—ñ–¥–µ–æ.');
        $btn.prop('disabled', false);
    });
});


        $('#ask').on('click', function () {
          gtag('event', 'click', { event_category: 'prediction', event_label: 'Ask button clicked' });

          const question = $('#question').val().trim();
          const deck = $('#deck').val();
          const count = parseInt($('#count').val(), 10);

          if (!question) {
            return $('#response').removeClass('d-none').html('‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–æ—Ä–æ–∂—ñ–Ω–Ω—è–º.');
          }
          if (isNaN(count) || count < 1 || count > 10) {
            return $('#response').removeClass('d-none').html('‚ö†Ô∏è –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞—Ä—Ç –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 1 –¥–æ 10.');
          }

          const $btn = $(this).prop('disabled', true);
          $('#response').removeClass('d-none').html('üîÆ –ú–æ–ª—å—Ñ–∞—Ä–∫–∞ —Ç–∞—Å—É—î –∫–∞—Ä—Ç–∏...');

          $.post('/draw/', JSON.stringify({ deck, count }), function (drawData) {
            const cards = drawData.cards || [];
            $('#response').html(`üÉè –û—Å—å —è–∫—ñ –∫–∞—Ä—Ç–∏ –≤–∏–ø–∞–ª–∏:<br><b class="h3 text-gradient">${cards.join(', ')}</b><br><br>‚ú® –¢–ª—É–º–∞—á–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è...`);

            $.post('/predict/', JSON.stringify({ question, cards, deck }), function (resultData) {
              $('#response').append('<br><br>' + (resultData.result || ''));
              $btn.prop('disabled', false);
              window.scrollTo({ top: $('#response').offset().top - 80, behavior: 'smooth' });
            }, 'json').fail(function () {
              $('#response').append('<br>üòî –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ç–ª—É–º–∞—á–µ–Ω–Ω—ñ.');
              $btn.prop('disabled', false);
            });

          }, 'json').fail(function () {
            $('#response').html('üòî –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –∫–∞—Ä—Ç.');
            $btn.prop('disabled', false);
          });
        });
      });
    </script>
  </body>
</html>
