<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Molfarka ‚Äî –Ü–Ü —Ä–æ–∑–∫–ª–∞–¥ –¢–∞—Ä–æ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-dark text-light">

<div class="container mt-5">
  <h1 class="mb-4">–ú–æ–ª—å—Ñ–∞—Ä–∫–∞ ‚Äî –ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –≤—ñ–¥ –®–Ü</h1>

  <div class="mb-3">
    <label for="question">–í–∞—à–µ –ø–∏—Ç–∞–Ω–Ω—è:</label>
    <input type="text" id="question" name="question" class="form-control" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –©–æ –º–µ–Ω–µ —á–µ–∫–∞—î —É –∫–æ—Ö–∞–Ω–Ω—ñ?">
  </div>

  <div class="mb-3">
    <label for="deck">–û–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É:</label>
    <select id="deck" name="deck" class="form-select">
      {% for deck in decks %}
        <option value="{{ deck.slug }}" data-max="{{ deck.max_cards }}">{{ deck.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞—Ä—Ç:</label>
    <input type="number" id="count" name="count" class="form-control" value="3" min="1" max="5">
  </div>

  <button id="ask" class="btn btn-primary">–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è</button>

  <div class="mt-4" id="response" style="white-space: pre-wrap;"></div>
</div>

<script>
$(document).ready(function () {
  $('#deck').on('change', function () {
    let max = $(this).find(':selected').data('max');
    $('#count').attr('max', max);
    if (parseInt($('#count').val()) > max) {
      $('#count').val(max);
    }
  });

  $('#ask').click(function () {
    let question = $('#question').val();
    let deck = $('#deck').val();
    let count = $('#count').val();

    $('#response').html('üîÆ –ú–æ–ª—å—Ñ–∞—Ä–∫–∞ —Ç–∞—Å—É—î –∫–∞—Ä—Ç–∏...');

    $.post('/predict/', {
      question: question,
      deck: deck,
      count: count
    }, function (data) {
      $('#response').html(data.result);
    }, 'json').fail(function () {
      $('#response').html('üòî –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞.');
    });
  });
});
</script>

</body>
</html>
